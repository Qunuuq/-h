<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø­Ø¯ÙŠØ« Ø§Ù„ÙŠÙˆÙ…</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø®Ø· Inter Ù„ØªØ­Ø³ÙŠÙ† Ø¬Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ù†Øµ ÙˆÙ‚Ø§Ø¨Ù„ÙŠØªÙ‡ Ù„Ù„Ù‚Ø±Ø§Ø¡Ø© */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Ù„ÙˆÙ† Ø®Ù„ÙÙŠØ© ÙØ§ØªØ­ ÙˆÙ…Ù‡Ø¯Ø¦ */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh; /* ÙŠØ¶Ù…Ù† Ø£Ù† Ø§Ù„ØµÙØ­Ø© ØªØ£Ø®Ø° ÙƒØ§Ù…Ù„ Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø´Ø§Ø´Ø© */
            margin: 0;
            padding: 20px; /* Ù…Ø³Ø§ÙØ© Ø¯Ø§Ø®Ù„ÙŠØ© Ø­ÙˆÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
            box-sizing: border-box; /* ÙŠØ¶Ù…Ù† Ø£Ù† Ø§Ù„Ø­Ø´ÙˆØ© Ù„Ø§ ØªØ²ÙŠØ¯ Ù…Ù† Ø­Ø¬Ù… Ø§Ù„Ø¹Ù†ØµØ± */
        }
        /* ØªØ­Ø¯ÙŠØ¯ Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù†Øµ Ù„Ù„ÙŠÙ…ÙŠÙ† ÙˆÙ…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ù†Øµ Ù„Ù„ÙŠÙ…ÙŠÙ† Ù„Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªÙŠ ØªØ­ØªØ§Ø¬ Ø°Ù„Ùƒ Ø¨Ø´ÙƒÙ„ Ø®Ø§Øµ */
        .text-arabic {
            direction: rtl;
            text-align: right;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
    <div class="bg-white rounded-lg shadow-xl p-8 max-w-2xl w-full text-center border border-gray-200">
        <h1 class="text-3xl font-bold text-gray-800 mb-6">Ø­Ø¯ÙŠØ« Ø§Ù„ÙŠÙˆÙ…</h1>

        <div class="mb-6">
            <button id="fetchNewHadithBtn"
                    class="bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg
                           transition duration-300 ease-in-out transform hover:scale-105
                           focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50">
                Ø­Ø¯ÙŠØ« Ø¬Ø¯ÙŠØ¯
            </button>
        </div>

        <div id="hadithDisplay" class="mt-8 p-6 bg-gray-50 rounded-lg border border-gray-200 text-arabic">
            <p class="text-gray-700 text-lg leading-relaxed mb-4" id="hadithText">
                Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ø£Ø¹Ù„Ø§Ù‡ Ù„Ø¬Ù„Ø¨ Ø­Ø¯ÙŠØ« Ø´Ø±ÙŠÙ Ø¬Ø¯ÙŠØ¯.
            </p>
            <p class="text-gray-500 text-sm font-medium" id="hadithSource">
                Ø§Ù„Ù…ØµØ¯Ø±: -
            </p>
            <button id="copyHadithBtn"
                    class="mt-4 bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded-lg
                           transition duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50 text-sm">
                Ù†Ø³Ø® Ø§Ù„Ø­Ø¯ÙŠØ«
            </button>
            <span id="hadithCopyStatus" class="text-sm text-green-600 ml-2 hidden">ØªÙ… Ø§Ù„Ù†Ø³Ø®!</span>
        </div>

        <div class="mt-4 flex flex-wrap justify-center gap-4">
            <button id="explainHadithBtn"
                    class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg
                           transition duration-300 ease-in-out transform hover:scale-105
                           focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">
                âœ¨ Ø§Ø´Ø±Ø­ Ø§Ù„Ø­Ø¯ÙŠØ«
            </button>
            <button id="extractLessonsBtn"
                    class="bg-orange-600 hover:bg-orange-700 text-white font-semibold py-3 px-6 rounded-lg
                           transition duration-300 ease-in-out transform hover:scale-105
                           focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-opacity-50">
                âœ¨ Ø§Ø³ØªØ®Ù„Øµ Ø§Ù„Ø¯Ø±ÙˆØ³ Ø§Ù„Ù…Ø³ØªÙØ§Ø¯Ø©
            </button>
            <button id="practicalApplicationsBtn"
                    class="bg-teal-600 hover:bg-teal-700 text-white font-semibold py-3 px-6 rounded-lg
                           transition duration-300 ease-in-out transform hover:scale-105
                           focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-opacity-50">
                âœ¨ ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø¹Ù…Ù„ÙŠØ©
            </button>
        </div>

        <div class="mb-6 mt-8 p-4 border border-gray-200 rounded-lg bg-gray-50">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">Ø§Ø³Ø£Ù„ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</h2>
            <div class="mb-4 flex items-center justify-center gap-2">
                <label for="searchInput" class="sr-only">Ø§Ø·Ø±Ø­ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§:</label>
                <input type="text" id="searchInput" placeholder="Ø§Ø·Ø±Ø­ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§"
                       class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
            </div>
            <button id="askAIBtn"
                    class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-6 rounded-lg
                           transition duration-300 ease-in-out transform hover:scale-105
                           focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50">
                ğŸ’¡ Ø§Ø³Ø£Ù„ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
            </button>
        </div>

        <div id="explanationDisplay" class="hidden mt-8 p-6 bg-blue-50 rounded-lg border border-blue-200 text-arabic">
            <h3 class="text-xl font-semibold text-blue-800 mb-2">Ø´Ø±Ø­ Ø§Ù„Ø­Ø¯ÙŠØ«:</h3>
            <p class="text-blue-800 text-lg leading-relaxed" id="explanationText">
                Ø§Ù„Ø´Ø±Ø­ Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§...
            </p>
            <button id="copyExplanationBtn"
                    class="mt-4 bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded-lg
                           transition duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50 text-sm">
                Ù†Ø³Ø® Ø§Ù„Ø´Ø±Ø­
            </button>
            <span id="explanationCopyStatus" class="text-sm text-green-600 ml-2 hidden">ØªÙ… Ø§Ù„Ù†Ø³Ø®!</span>
        </div>

        <div id="lessonsDisplay" class="hidden mt-8 p-6 bg-orange-50 rounded-lg border border-orange-200 text-arabic">
            <h3 class="text-xl font-semibold text-orange-800 mb-2">Ø§Ù„Ø¯Ø±ÙˆØ³ Ø§Ù„Ù…Ø³ØªÙØ§Ø¯Ø©:</h3>
            <p class="text-orange-800 text-lg leading-relaxed" id="lessonsText">
                Ø§Ù„Ø¯Ø±ÙˆØ³ Ø§Ù„Ù…Ø³ØªÙØ§Ø¯Ø© Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§...
            </p>
            <button id="copyLessonsBtn"
                    class="mt-4 bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded-lg
                           transition duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50 text-sm">
                Ù†Ø³Ø® Ø§Ù„Ø¯Ø±ÙˆØ³
            </button>
            <span id="lessonsCopyStatus" class="text-sm text-green-600 ml-2 hidden">ØªÙ… Ø§Ù„Ù†Ø³Ø®!</span>
        </div>

        <div id="practicalApplicationsDisplay" class="hidden mt-8 p-6 bg-teal-50 rounded-lg border border-teal-200 text-arabic">
            <h3 class="text-xl font-semibold text-teal-800 mb-2">ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø¹Ù…Ù„ÙŠØ©:</h3>
            <p class="text-teal-800 text-lg leading-relaxed" id="practicalApplicationsText">
                Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§...
            </p>
            <button id="copyPracticalApplicationsBtn"
                    class="mt-4 bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded-lg
                           transition duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50 text-sm">
                Ù†Ø³Ø® Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª
            </button>
            <span id="practicalApplicationsCopyStatus" class="text-sm text-green-600 ml-2 hidden">ØªÙ… Ø§Ù„Ù†Ø³Ø®!</span>
        </div>

        <div id="aiAnswerDisplay" class="hidden mt-8 p-6 bg-indigo-50 rounded-lg border border-indigo-200 text-arabic">
            <h3 class="text-xl font-semibold text-indigo-800 mb-2">Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ:</h3>
            <p class="text-indigo-800 text-lg leading-relaxed" id="aiAnswerText">
                Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§...
            </p>
            <button id="copyAIAnswerBtn"
                    class="mt-4 bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded-lg
                           transition duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50 text-sm">
                Ù†Ø³Ø® Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©
            </button>
            <span id="aiAnswerCopyStatus" class="text-sm text-green-600 ml-2 hidden">ØªÙ… Ø§Ù„Ù†Ø³Ø®!</span>
        </div>

        <div id="loadingIndicator" class="hidden mt-4 text-gray-600 font-medium">
            Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...
        </div>

        <div id="explanationLoadingIndicator" class="hidden mt-4 text-gray-600 font-medium">
            Ø¬Ø§Ø±ÙŠ Ø´Ø±Ø­ Ø§Ù„Ø­Ø¯ÙŠØ«...
        </div>

        <div id="lessonsLoadingIndicator" class="hidden mt-4 text-gray-600 font-medium">
            Ø¬Ø§Ø±ÙŠ Ø§Ø³ØªØ®Ù„Ø§Øµ Ø§Ù„Ø¯Ø±ÙˆØ³...
        </div>

        <div id="practicalApplicationsLoadingIndicator" class="hidden mt-4 text-gray-600 font-medium">
            Ø¬Ø§Ø±ÙŠ Ø§Ù‚ØªØ±Ø§Ø­ ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø¹Ù…Ù„ÙŠØ©...
        </div>

        <div id="aiAnswerLoadingIndicator" class="hidden mt-4 text-gray-600 font-medium">
            Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©...
        </div>

        <div id="errorDisplay" class="hidden mt-4 p-3 bg-red-100 text-red-700 rounded-lg border border-red-200">
            Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ø­Ø¯ÙŠØ«. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª ÙˆØ§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.
        </div>

        <div id="explanationErrorDisplay" class="hidden mt-4 p-3 bg-red-100 text-red-700 rounded-lg border border-red-200">
            Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø´Ø±Ø­ Ø§Ù„Ø­Ø¯ÙŠØ«. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.
        </div>

        <div id="lessonsErrorDisplay" class="hidden mt-4 p-3 bg-red-100 text-red-700 rounded-lg border border-red-200">
            Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ø³ØªØ®Ù„Ø§Øµ Ø§Ù„Ø¯Ø±ÙˆØ³. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.
        </div>

        <div id="practicalApplicationsErrorDisplay" class="hidden mt-4 p-3 bg-red-100 text-red-700 rounded-lg border border-red-200">
            Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù‚ØªØ±Ø§Ø­ ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø¹Ù…Ù„ÙŠØ©. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.
        </div>

        <div id="aiAnswerErrorDisplay" class="hidden mt-4 p-3 bg-red-100 text-red-700 rounded-lg border border-red-200">
            Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø³Ø¤Ø§Ù„Ùƒ. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.
        </div>
    </div>

    <script>
        // Getting references to DOM elements by their IDs
        const fetchNewHadithBtn = document.getElementById('fetchNewHadithBtn');
        const explainHadithBtn = document.getElementById('explainHadithBtn');
        const extractLessonsBtn = document.getElementById('extractLessonsBtn');
        const practicalApplicationsBtn = document.getElementById('practicalApplicationsBtn');
        const searchInput = document.getElementById('searchInput');
        const askAIBtn = document.getElementById('askAIBtn');

        const hadithText = document.getElementById('hadithText');
        const hadithSource = document.getElementById('hadithSource');
        const copyHadithBtn = document.getElementById('copyHadithBtn');
        const hadithCopyStatus = document.getElementById('hadithCopyStatus');

        const explanationDisplay = document.getElementById('explanationDisplay');
        const explanationText = document.getElementById('explanationText');
        const copyExplanationBtn = document.getElementById('copyExplanationBtn');
        const explanationCopyStatus = document.getElementById('explanationCopyStatus');

        const lessonsDisplay = document.getElementById('lessonsDisplay');
        const lessonsText = document.getElementById('lessonsText');
        const copyLessonsBtn = document.getElementById('copyLessonsBtn');
        const lessonsCopyStatus = document.getElementById('lessonsCopyStatus');

        const practicalApplicationsDisplay = document.getElementById('practicalApplicationsDisplay');
        const practicalApplicationsText = document.getElementById('practicalApplicationsText');
        const copyPracticalApplicationsBtn = document.getElementById('copyPracticalApplicationsBtn');
        const practicalApplicationsCopyStatus = document.getElementById('practicalApplicationsCopyStatus');

        const aiAnswerDisplay = document.getElementById('aiAnswerDisplay');
        const aiAnswerText = document.getElementById('aiAnswerText');
        const copyAIAnswerBtn = document.getElementById('copyAIAnswerBtn');
        const aiAnswerCopyStatus = document.getElementById('aiAnswerCopyStatus');

        const loadingIndicator = document.getElementById('loadingIndicator');
        const explanationLoadingIndicator = document.getElementById('explanationLoadingIndicator');
        const lessonsLoadingIndicator = document.getElementById('lessonsLoadingIndicator');
        const practicalApplicationsLoadingIndicator = document.getElementById('practicalApplicationsLoadingIndicator');
        const aiAnswerLoadingIndicator = document.getElementById('aiAnswerLoadingIndicator');
        const errorDisplay = document.getElementById('errorDisplay');
        const explanationErrorDisplay = document.getElementById('explanationErrorDisplay');
        const lessonsErrorDisplay = document.getElementById('lessonsErrorDisplay');
        const practicalApplicationsErrorDisplay = document.getElementById('practicalApplicationsErrorDisplay');
        const aiAnswerErrorDisplay = document.getElementById('aiAnswerErrorDisplay');

        // List of available Hadith books and their available count
        const hadithBooksData = [
            { name: "HR. Abu Daud", id: "abu-daud", available: 4419 },
            { name: "HR. Ahmad", id: "ahmad", available: 4305 },
            { name: "HR. Bukhari", id: "bukhari", available: 6638 },
            { name: "HR. Darimi", id: "darimi", available: 2949 },
            { name: "HR. Ibnu Majah", id: "ibnu-majah", available: 4285 },
            { name: "HR. Malik", id: "malik", available: 1587 },
            { name: "HR. Muslim", id: "muslim", available: 4930 },
            { name: "HR. Nasai", id: "nasai", available: 5364 },
            { name: "HR. Tirmidzi", id: "tirmidzi", available: 3625 }
        ];

        // Speech Synthesis variables (kept for reading out AI answers)
        let synth;
        let arabicVoice;

        // Initialize SpeechSynthesis
        if ('speechSynthesis' in window) {
            synth = window.speechSynthesis;
            synth.onvoiceschanged = () => {
                const voices = synth.getVoices();
                arabicVoice = voices.find(voice => voice.lang.startsWith('ar')) || voices.find(voice => voice.lang.includes('ar'));
                if (!arabicVoice) {
                    console.warn('No Arabic voice found. Default voice will be used.');
                }
            };
        } else {
            console.warn('Your browser does not support speech output.');
        }

        /**
         * Helper function to disable or enable all buttons.
         * @param {boolean} disable - true to disable buttons, false to enable them.
         */
        function disableAllButtons(disable) {
            fetchNewHadithBtn.disabled = disable;
            explainHadithBtn.disabled = disable;
            extractLessonsBtn.disabled = disable;
            practicalApplicationsBtn.disabled = disable;
            askAIBtn.disabled = disable;
            copyHadithBtn.disabled = disable;
            copyExplanationBtn.disabled = disable;
            copyLessonsBtn.disabled = disable;
            copyPracticalApplicationsBtn.disabled = disable;
            copyAIAnswerBtn.disabled = disable;
        }

        // Helper function to hide all status messages, extra display areas, and copy statuses
        function hideAllStatusMessages() {
            loadingIndicator.classList.add('hidden');
            explanationLoadingIndicator.classList.add('hidden');
            lessonsLoadingIndicator.classList.add('hidden');
            practicalApplicationsLoadingIndicator.classList.add('hidden');
            aiAnswerLoadingIndicator.classList.add('hidden');
            errorDisplay.classList.add('hidden');
            explanationErrorDisplay.classList.add('hidden');
            lessonsErrorDisplay.classList.add('hidden');
            practicalApplicationsErrorDisplay.classList.add('hidden');
            aiAnswerErrorDisplay.classList.add('hidden');
            explanationDisplay.classList.add('hidden');
            lessonsDisplay.classList.add('hidden');
            practicalApplicationsDisplay.classList.add('hidden');
            aiAnswerDisplay.classList.add('hidden');

            // Hide copy status messages
            hadithCopyStatus.classList.add('hidden');
            explanationCopyStatus.classList.add('hidden');
            lessonsCopyStatus.classList.add('hidden');
            practicalApplicationsCopyStatus.classList.add('hidden');
            aiAnswerCopyStatus.classList.add('hidden');
        }

        /**
         * Helper function to copy text to clipboard.
         * Uses document.execCommand('copy') as navigator.clipboard.writeText() might not work in iframe environments.
         * @param {string} textToCopy - The text to be copied.
         * @param {HTMLElement} statusElement - The element that will display the status message (e.g., "Copied!").
         */
        function copyTextToClipboard(textToCopy, statusElement) {
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = textToCopy;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            try {
                document.execCommand('copy');
                if (statusElement) {
                    statusElement.classList.remove('hidden');
                    setTimeout(() => {
                        statusElement.classList.add('hidden');
                    }, 2000); // Hide message after 2 seconds
                }
            } catch (err) {
                console.error('Failed to copy text: ', err);
                // Optionally, add a visible error message to the user here
            } finally {
                document.body.removeChild(tempTextArea);
            }
        }

        /**
         * Asynchronous function to fetch a random hadith from a selected book.
         * A random number is chosen within the available range of hadiths for the book.
         */
        async function fetchHadithOfTheDay() {
            hideAllStatusMessages(); // Hide all messages before starting
            loadingIndicator.classList.remove('hidden');
            disableAllButtons(true); // Disable all buttons

            try {
                // Choose a random book from the list of available books
                const randomBookData = hadithBooksData[Math.floor(Math.random() * hadithBooksData.length)];
                const randomBookId = randomBookData.id;
                const maxHadithNumber = randomBookData.available;

                // Choose a random hadith number within the available range for this book
                const randomHadithNumber = Math.floor(Math.random() * maxHadithNumber) + 1;

                const apiUrl = `https://api.hadith.gading.dev/books/${randomBookId}/${randomHadithNumber}`;
                const response = await fetch(apiUrl);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();

                if (data && data.data && data.data.contents && data.data.contents.arab) {
                    hadithText.textContent = data.data.contents.arab;
                    hadithSource.textContent = `Ø§Ù„Ù…ØµØ¯Ø±: ${data.data.name} - Ø­Ø¯ÙŠØ« Ø±Ù‚Ù… ${data.data.contents.number}`;
                } else {
                    console.warn(`Hadith not found for ${randomBookId} at number ${randomHadithNumber}. Trying again.`);
                    await fetchHadithOfTheDay(); // Try fetching another hadith
                    return; // End current execution to avoid updating the UI twice
                }

            } catch (error) {
                console.error('Error fetching hadith:', error);
                errorDisplay.classList.remove('hidden');
                hadithText.textContent = 'ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø§Ù„Ø­Ø¯ÙŠØ«. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹.';
                hadithSource.textContent = 'Ø§Ù„Ù…ØµØ¯Ø±: -';
            } finally {
                loadingIndicator.classList.add('hidden');
                disableAllButtons(false); // Re-enable all buttons
            }
        }

        /**
         * Asynchronous function to explain the hadith using Gemini API.
         */
        async function explainHadith() {
            const currentHadith = hadithText.textContent;

            if (!currentHadith || currentHadith.includes('Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø±') || currentHadith.includes('ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø§Ù„Ø­Ø¯ÙŠØ«') || currentHadith.includes('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø­Ø¯ÙŠØ«')) {
                explanationText.textContent = 'ÙŠØ±Ø¬Ù‰ Ø¬Ù„Ø¨ Ø­Ø¯ÙŠØ« Ø£ÙˆÙ„Ø§Ù‹ Ù‚Ø¨Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø´Ø±Ø­.';
                explanationDisplay.classList.remove('hidden');
                return;
            }

            hideAllStatusMessages(); // Hide all other messages and areas
            explanationLoadingIndicator.classList.remove('hidden');
            disableAllButtons(true); // Disable all buttons

            try {
                const prompt = `Ø§Ø´Ø±Ø­ Ø§Ù„Ø­Ø¯ÙŠØ« Ø§Ù„ØªØ§Ù„ÙŠ Ø¨Ø£Ø³Ù„ÙˆØ¨ Ù…Ø¨Ø³Ø· ÙˆÙ…Ø®ØªØµØ±ØŒ Ù…Ø¹ Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¹Ù†Ù‰ Ø§Ù„Ø¹Ø§Ù… ÙˆØ§Ù„ÙØ§Ø¦Ø¯Ø© Ø§Ù„Ù…Ø³ØªÙØ§Ø¯Ø© Ù…Ù†Ù‡ØŒ ÙˆØ¨Ù…Ø§ Ù„Ø§ ÙŠØªØ¬Ø§ÙˆØ² 150 ÙƒÙ„Ù…Ø©ØŒ Ù…Ø¹ Ø°ÙƒØ± Ø§Ù„Ù…ØµØ¯Ø± Ø¥Ù† Ø£Ù…ÙƒÙ†: "${currentHadith}"`;

                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                // IMPORTANT: When deploying this application outside of the Google Canvas environment,
                // you need to provide your own Gemini API Key.
                // You can get one from Google AI Studio: https://aistudio.google.com/app/apikey
                //
                // WARNING: Directly embedding API keys in client-side code is NOT secure for production applications.
                // For production, it is highly recommended to use a backend proxy server to keep your API key secure.
                const apiKey = "AIzaSyDbeleLFWRXBWVMS7eyzRvoR6Sj-wsIjwY"; // <-- Ù…ÙØªØ§Ø­ Ø§Ù„Ù€ API Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù‡Ù†Ø§
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const explanation = result.candidates[0].content.parts[0].text;
                    explanationText.textContent = explanation;
                    explanationDisplay.classList.remove('hidden');
                } else {
                    throw new Error('Ù‡Ù†Ø§Ùƒ Ø®Ø·Ø§ Ø¨Ø³Ø¨Ø¨ Ø§Ù„Ø´Ø±Ø­ Ø¨ÙˆØ§Ø³Ø·Ù‡ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ');
                }

            } catch (error) {
                console.error('Error explaining hadith:', error);
                explanationErrorDisplay.classList.remove('hidden');
                explanationText.textContent = 'ØªØ¹Ø°Ø± Ø´Ø±Ø­ Ø§Ù„Ø­Ø¯ÙŠØ«. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹.';
                explanationDisplay.classList.remove('hidden');
            } finally {
                explanationLoadingIndicator.classList.add('hidden');
                disableAllButtons(false); // Re-enable all buttons
            }
        }

        /**
         * Asynchronous function to extract lessons learned from the hadith using Gemini API.
         */
        async function extractLessons() {
            const currentHadith = hadithText.textContent;

            if (!currentHadith || currentHadith.includes('Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø±') || currentHadith.includes('ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø§Ù„Ø­Ø¯ÙŠØ«') || currentHadith.includes('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø­Ø¯ÙŠØ«')) {
                lessonsText.textContent = 'ÙŠØ±Ø¬Ù‰ Ø¬Ù„Ø¨ Ø­Ø¯ÙŠØ« Ø£ÙˆÙ„Ø§Ù‹ Ù‚Ø¨Ù„ Ø·Ù„Ø¨ Ø§Ø³ØªØ®Ù„Ø§Øµ Ø§Ù„Ø¯Ø±ÙˆØ³.';
                lessonsDisplay.classList.remove('hidden');
                return;
            }

            hideAllStatusMessages(); // Hide all other messages and areas
            lessonsLoadingIndicator.classList.remove('hidden');
            disableAllButtons(true); // Disable all buttons

            try {
                const prompt = `Ø§Ø³ØªØ®Ù„Øµ Ø£Ù‡Ù… 3-5 Ø¯Ø±ÙˆØ³ Ø£Ùˆ ÙÙˆØ§Ø¦Ø¯ Ù…Ø³ØªÙØ§Ø¯Ø© Ù…Ù† Ø§Ù„Ø­Ø¯ÙŠØ« Ø§Ù„ØªØ§Ù„ÙŠ Ø¨Ø£Ø³Ù„ÙˆØ¨ Ù†Ù‚Ø·ÙŠ ÙˆÙ…Ø®ØªØµØ±: "${currentHadith}"`;

                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                // IMPORTANT: When deploying this application outside of the Google Canvas environment,
                // you need to provide your own Gemini API Key.
                // You can get one from Google AI Studio: https://aistudio.google.com/app/apikey
                //
                // WARNING: Directly embedding API keys in client-side code is NOT secure for production applications.
                // For production, it is highly recommended to use a backend proxy server to keep your API key secure.
                const apiKey = "AIzaSyDbeleLFWRXBWVMS7eyzRvoR6Sj-wsIjwY"; // <-- Ù…ÙØªØ§Ø­ Ø§Ù„Ù€ API Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù‡Ù†Ø§
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const lessons = result.candidates[0].content.parts[0].text;
                    lessonsText.textContent = lessons;
                    lessonsDisplay.classList.remove('hidden');
                } else {
                    throw new Error('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¯Ø±ÙˆØ³ Ù…Ù† Gemini API.');
                }

            } catch (error) {
                console.error('Error extracting lessons:', error);
                lessonsErrorDisplay.classList.remove('hidden');
                lessonsText.textContent = 'ØªØ¹Ø°Ø± Ø§Ø³ØªØ®Ù„Ø§Øµ Ø§Ù„Ø¯Ø±ÙˆØ³. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹.';
                lessonsDisplay.classList.remove('hidden');
            } finally {
                lessonsLoadingIndicator.classList.add('hidden');
                disableAllButtons(false); // Re-enable all buttons
            }
        }

        /**
         * Asynchronous function to generate practical applications for the hadith using Gemini API.
         */
        async function generatePracticalApplications() {
            const currentHadith = hadithText.textContent;

            if (!currentHadith || currentHadith.includes('Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø±') || currentHadith.includes('ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø§Ù„Ø­Ø¯ÙŠØ«') || currentHadith.includes('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø­Ø¯ÙŠØ«')) {
                practicalApplicationsText.textContent = 'ÙŠØ±Ø¬Ù‰ Ø¬Ù„Ø¨ Ø­Ø¯ÙŠØ« Ø£ÙˆÙ„Ø§Ù‹ Ù‚Ø¨Ù„ Ø·Ù„Ø¨ ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø¹Ù…Ù„ÙŠØ©.';
                practicalApplicationsDisplay.classList.remove('hidden');
                return;
            }

            hideAllStatusMessages(); // Hide all other messages and areas
            practicalApplicationsLoadingIndicator.classList.remove('hidden');
            disableAllButtons(true); // Disable all buttons

            try {
                const prompt = `Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø¯ÙŠØ« Ø§Ù„ØªØ§Ù„ÙŠØŒ Ø§Ù‚ØªØ±Ø­ 3-5 ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø¹Ù…Ù„ÙŠØ© Ø£Ùˆ Ø®Ø·ÙˆØ§Øª ÙŠÙ…ÙƒÙ† Ù„Ù„Ù…Ø³Ù„Ù… Ø§ØªØ®Ø§Ø°Ù‡Ø§ ÙÙŠ Ø­ÙŠØ§ØªÙ‡ Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ù„ØªØ·Ø¨ÙŠÙ‚ Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¯ÙŠØ«ØŒ Ø¨Ø£Ø³Ù„ÙˆØ¨ Ù†Ù‚Ø·ÙŠ ÙˆÙ…Ø®ØªØµØ±: "${currentHadith}"`;

                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                // IMPORTANT: When deploying this application outside of the Google Canvas environment,
                // you need to provide your own Gemini API Key.
                // You can get one from Google AI Studio: https://aistudio.google.com/app/apikey
                //
                // WARNING: Directly embedding API keys in client-side code is NOT secure for production applications.
                // For production, it is highly recommended to use a backend proxy server to keep your API key secure.
                const apiKey = "AIzaSyDbeleLFWRXBWVMS7eyzRvoR6Sj-wsIjwY"; // <-- Ù…ÙØªØ§Ø­ Ø§Ù„Ù€ API Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù‡Ù†Ø§
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const applications = result.candidates[0].content.parts[0].text;
                    practicalApplicationsText.textContent = applications;
                    practicalApplicationsDisplay.classList.remove('hidden');
                } else {
                    throw new Error('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø¹Ù…Ù„ÙŠØ© Ù…Ù† Gemini API.');
                }

            } catch (error) {
                console.error('Error generating practical applications:', error);
                practicalApplicationsErrorDisplay.classList.remove('hidden');
                practicalApplicationsText.textContent = 'ØªØ¹Ø°Ø± Ø§Ù‚ØªØ±Ø§Ø­ ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø¹Ù…Ù„ÙŠØ©. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹.';
                practicalApplicationsDisplay.classList.remove('hidden');
            } finally {
                practicalApplicationsLoadingIndicator.classList.add('hidden');
                disableAllButtons(false); // Re-enable all buttons
            }
        }

        /**
         * Asynchronous function to answer user questions using Gemini API.
         */
        async function askAI() {
            const query = searchInput.value.trim();

            if (!query) {
                aiAnswerText.textContent = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¤Ø§Ù„Ùƒ.';
                aiAnswerDisplay.classList.remove('hidden');
                return;
            }

            hideAllStatusMessages(); // Hide all other messages and areas
            aiAnswerLoadingIndicator.classList.remove('hidden');
            disableAllButtons(true); // Disable all buttons

            try {
                const prompt = `Ø£Ø¬Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù…Ø¹Ø±ÙØªÙƒ Ø¨Ø§Ù„Ø£Ø­Ø§Ø¯ÙŠØ« ÙˆØ§Ù„Ù…ÙØ§Ù‡ÙŠÙ… Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©: "${query}". Ù‚Ø¯Ù… Ø¥Ø¬Ø§Ø¨Ø© Ø´Ø§Ù…Ù„Ø© ÙˆÙ…Ø®ØªØµØ±Ø©.`;

                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                // IMPORTANT: When deploying this application outside of the Google Canvas environment,
                // you need to provide your own Gemini API Key.
                // You can get one from Google AI Studio: https://aistudio.google.com/app/apikey
                //
                // WARNING: Directly embedding API keys in client-side code is NOT secure for production applications.
                // For production, it is highly recommended to use a backend proxy server to keep your API key secure.
                const apiKey = "AIzaSyDbeleLFWRXBWVMS7eyzRvoR6Sj-wsIjwY"; // <-- Ù…ÙØªØ§Ø­ Ø§Ù„Ù€ API Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù‡Ù†Ø§
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const answer = result.candidates[0].content.parts[0].text;
                    aiAnswerText.textContent = answer;
                    aiAnswerDisplay.classList.remove('hidden');

                    // Read the answer aloud
                    if (synth && arabicVoice) {
                        const utterance = new SpeechSynthesisUtterance(answer);
                        utterance.voice = arabicVoice;
                        utterance.lang = 'ar-SA';
                        synth.speak(utterance);
                    } else if (synth) {
                        const utterance = new SpeechSynthesisUtterance(answer);
                        synth.speak(utterance);
                    }

                } else {
                    throw new Error('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¥Ø¬Ø§Ø¨Ø© Ù…Ù† Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ.');
                }

            } catch (error) {
                console.error('Error answering question:', error);
                aiAnswerErrorDisplay.classList.remove('hidden');
                aiAnswerText.textContent = 'ØªØ¹Ø°Ø± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„Ù‰ Ø³Ø¤Ø§Ù„Ùƒ. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹.';
                aiAnswerDisplay.classList.remove('hidden');
            } finally {
                aiAnswerLoadingIndicator.classList.add('hidden');
                disableAllButtons(false); // Re-enable all buttons
            }
        }

        // Add click listener for "Fetch New Hadith" button
        fetchNewHadithBtn.addEventListener('click', fetchHadithOfTheDay);

        // Add click listener for "Explain Hadith" button
        explainHadithBtn.addEventListener('click', explainHadith);

        // Add click listener for "Extract Lessons" button
        extractLessonsBtn.addEventListener('click', extractLessons);

        // Add click listener for "Practical Applications" button
        practicalApplicationsBtn.addEventListener('click', generatePracticalApplications);

        // Add click listener for "Ask AI" button
        askAIBtn.addEventListener('click', askAI);

        // Add click listeners for copy buttons
        copyHadithBtn.addEventListener('click', () => copyTextToClipboard(hadithText.textContent, hadithCopyStatus));
        copyExplanationBtn.addEventListener('click', () => copyTextToClipboard(explanationText.textContent, explanationCopyStatus));
        copyLessonsBtn.addEventListener('click', () => copyTextToClipboard(lessonsText.textContent, lessonsCopyStatus));
        copyPracticalApplicationsBtn.addEventListener('click', () => copyTextToClipboard(practicalApplicationsText.textContent, practicalApplicationsCopyStatus));
        copyAIAnswerBtn.addEventListener('click', () => copyTextToClipboard(aiAnswerText.textContent, aiAnswerCopyStatus));


        // Fetch a hadith automatically on page load
        document.addEventListener('DOMContentLoaded', fetchHadithOfTheDay);
    </script>
</body>
</html>
